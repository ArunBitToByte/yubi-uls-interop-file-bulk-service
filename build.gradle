plugins { id 'de.undercouch.download' version '5.3.0' }

allprojects {
    group = 'com.yubi.uls.file.bulk'
    version = "0.0.1-SNAPSHOT"

    apply plugin: 'java'
    apply plugin: 'java-library'
    apply plugin: 'maven-publish'
    apply plugin: 'jacoco'
    build.dependsOn jacocoTestReport

    jacocoTestReport {
        reports {
            xml.required = true
        }
    }

    repositories {
        mavenCentral()
        maven {
            url 'https://yubi-artifact-155577958684.d.codeartifact.ap-south-1.amazonaws.com/maven/interop/'
            credentials {
                username "aws"
                password "eyJ2ZXIiOjEsImlzdSI6MTcxNTc2Njg3MiwiZW5jIjoiQTEyOEdDTSIsInRhZyI6Il8tQXdmMjJtWDZaZDA5WjE4WWk2WEEiLCJleHAiOjE3MTU4MTAwNzIsImFsZyI6IkExMjhHQ01LVyIsIml2IjoidjJkSHRLWjV6WkxHcE8wZiJ9.xXbav0PTWkm13Qe95rmqCQ.uj3fNJg0ePoqQDuh.LAqOeGBMR_W4sGM5f7MQZra1tw6m6ZkRWppN3g40Dghx6bliIYTmi8T7eHgLyeUm6WcR38Hv5fX8bkzRgkUzqNXnjDreoA0neS5fwodBRAuFTf8mN1biZruXuyOLG58G-FCddVZ7nOen1L_z3AxtQedk_jqupG8G7cJIqDq1NOb-UvRYlovJM7QELUZfjDf7UXlETlDxTtK199bet3tO1i1eqTlBa0Hlkt7uvz-V_J2HJPaIVvLh1DNBlxtlWWOqw5WY_uLo87hK89mt91YV9bX8TPUnkBr4dGqvm9-DJ4Cwri_1Fg_iL0NGDlGtfAA0X_5-DpR-YQfcGRDVU1gd6H_pMtVSkIBVWavfRZM3L4m2aQefzkZMKarPQJol1HcAowushJkJPt9Mg9bxrKQNyZv6vxYRv7qt3he9psaVZalOXSzgwMBbQDDnh1u__lpNDYOs7aGBZT2XrJDkgqDXsR9byUtLtwJc4Nn70zXjPDx4rHfRyJVmtjtmMzNWnp8F8RFVmSlquzWTgJ7JtHsVSTpxNa0_3D96Se2P2DooXHvhMjNwVTdKunr1e4LiBFq7Xm5XGQ0-q9-EGCfG-YeKLUlyv2l8N2Rwzi12N1-cm-0WtuQBNCJY38_aOZRk_4gXRZUe7XVX54dKEUiLfGq4S1b_EsqgGKwiRrMrPcfL-on60KBZt2sHg9jJiYIO9H-7CJdO7OTwd6mphDk5OxqaHiJB7BNHylwRRWZ0tDssoj9PXHifk9MVZp0Oz74ZOCudc3iKPcgnymgbDHKyngneKYjBzQDhGfBllsiAtKmLE6Sas8JPmrSCmiWa8RlTo7Z6oxGdmctKtXei6JKK0GFQIfl4NMGeuwFk541SbSRhYsJR-5w0lwq855wWMovuEGRhNuNy8l8Bzu2M0ydF0qOPBIVmHH12eP_XAnWH8AKPXnGgxfQ6Og-Q6iiToQPCQ7PusLXMGjAlKxeGwh01LcdR--RNvsQK9h1oAHkWecdWfd7vIwgTjmk9Xfwdea-nOWzRXd7Lfajj1_DPKl68QsQIv1Ma7ceCZC0jho1zokIsxW0_H5e14Wj1VjtNpJ_gIFK2yrbVN6rU50WBb8_TD5eonsa1oiAD7DN8da5fvgX8OzgkUy5tflUkJUDTkaPQZ54ZfRceCqdXCN9IHpR2BmLqf0Emjm9OQeFa0k9-U8CdSQXi.6WeeglTQUpjtqE_UQZAQWA"
            }
        }
    }

    publishing {
        publications {
            mavenJava(MavenPublication) {
                from components.java
            }
        }
        repositories {
            maven {
                url 'https://yubi-artifact-155577958684.d.codeartifact.ap-south-1.amazonaws.com/maven/interop/'
                credentials {
                    username "aws"
                    password System.env.CODEARTIFACT_AUTH_TOKEN
                }
            }
        }
    }

    tasks.register('downloadNewrelic', Download) {
        mkdir 'newrelic'
        src 'https://download.newrelic.com/newrelic/java-agent/newrelic-agent/current/newrelic-java.zip'
        dest file('newrelic')
    }
    tasks.register('unzipNewrelic', Copy) {
        from zipTree(file('newrelic/newrelic-java.zip'))
        into rootDir
    }
}